<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claire's Pay Comparator</title>

  <!-- Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; }
    /* Remove spinner from number inputs */
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

    /* Custom range slider styling */
    input[type=range] {
      -webkit-appearance: none;
      background: transparent;
    }
    input[type=range]:focus {
      outline: none;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 20px;
      width: 20px;
      border-radius: 50%;
      background: #ea580c; /* orange-600 */
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      margin-top: -8px;
      cursor: pointer;
      transition: transform 0.1s;
    }
    input[type=range]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
    }
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%;
      height: 6px;
      cursor: pointer;
      background: #fed7aa; /* orange-200 */
      border-radius: 99px;
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen overflow-y-auto">

<div id="app" class="max-w-7xl mx-auto p-4 md:p-8">

  <!-- Header -->
  <header class="mb-8 flex flex-col md:flex-row md:items-end md:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Compensation Comparator</h1>
      <p class="text-slate-500 mt-1">Analyzing Claire's transition from Per-Item to Hourly+Bonus</p>
    </div>
    <div class="text-right hidden md:block">
      <div class="text-xs font-semibold uppercase text-slate-400 tracking-wider mb-1">Current Proposed Rate</div>
      <div class="text-2xl font-bold text-indigo-600">${{ config.newHourlyRate }}/hr</div>
    </div>
  </header>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

    <!-- ================= INPUTS COLUMN ================= -->
    <div class="lg:col-span-4 space-y-6">

      <!-- 1. Session Mix Card -->
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
        <div class="flex items-center gap-2 mb-4">
          <span class="bg-blue-100 text-blue-700 w-6 h-6 flex items-center justify-center rounded-full text-xs font-bold">1</span>
          <h2 class="text-lg font-semibold text-slate-800">Session Mix (Per Paycheck)</h2>
        </div>

        <div class="grid grid-cols-3 gap-3 mb-6">
          <!-- 30 Min -->
          <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center hover:border-blue-200 transition-colors">
            <label class="block text-xs font-semibold text-slate-500 mb-2 uppercase tracking-wide">30 Mins</label>
            <input type="number" v-model.number="inputs.count30" min="0" class="w-full text-center bg-white border border-slate-200 rounded-lg px-1 py-2 text-xl font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
          </div>
          <!-- 60 Min -->
          <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center hover:border-blue-200 transition-colors">
            <label class="block text-xs font-semibold text-slate-500 mb-2 uppercase tracking-wide">60 Mins</label>
            <input type="number" v-model.number="inputs.count60" min="0" class="w-full text-center bg-white border border-slate-200 rounded-lg px-1 py-2 text-xl font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
          </div>
          <!-- 90 Min -->
          <div class="bg-slate-50 p-3 rounded-xl border border-slate-100 text-center hover:border-blue-200 transition-colors">
            <label class="block text-xs font-semibold text-slate-500 mb-2 uppercase tracking-wide">90 Mins</label>
            <input type="number" v-model.number="inputs.count90" min="0" class="w-full text-center bg-white border border-slate-200 rounded-lg px-1 py-2 text-xl font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
          </div>
        </div>

        <!-- Classification Logic for Old Pay -->
        <div class="mb-6 p-4 bg-orange-50 rounded-xl border border-orange-100 relative overflow-hidden">
          <div class="flex justify-between items-end mb-3 relative z-10">
            <div>
              <label class="text-xs font-bold text-orange-800 uppercase tracking-wide block mb-1">Session Classification</label>
              <p class="text-xs text-orange-600/80 leading-snug">
                Only matters for Old Pay.<br>How many total sessions are "Initial"?
              </p>
            </div>
            <div class="text-right">
              <span class="text-2xl font-bold text-orange-600">{{ inputs.initialCount }}</span>
              <span class="text-xs text-orange-400 font-medium block">of {{ totalSessions }} total</span>
            </div>
          </div>
          <input type="range" min="0" :max="totalSessions" v-model.number="inputs.initialCount" class="w-full relative z-10">
        </div>
      </div>

      <!-- 2. Hours & Admin Card -->
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
        <div class="flex items-center gap-2 mb-4">
          <span class="bg-blue-100 text-blue-700 w-6 h-6 flex items-center justify-center rounded-full text-xs font-bold">2</span>
          <h2 class="text-lg font-semibold text-slate-800">Paycheck Variables</h2>
        </div>

        <div class="space-y-4">
          <!-- Standard Admin -->
          <div class="flex items-center justify-between group">
            <label class="text-sm font-medium text-slate-600">Standard Admin ($15/hr)</label>
            <div class="flex items-center gap-2">
              <input type="number" v-model.number="inputs.adminStdHours" class="w-20 bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-right font-semibold focus:ring-2 focus:ring-blue-500 outline-none">
              <span class="text-xs text-slate-400 w-6">hrs</span>
            </div>
          </div>

          <!-- Specialized Admin -->
          <div class="flex items-center justify-between group">
            <label class="text-sm font-medium text-slate-600">Specialized Admin ($18/hr)</label>
            <div class="flex items-center gap-2">
              <input type="number" v-model.number="inputs.adminSpecHours" class="w-20 bg-slate-50 border border-slate-200 rounded-lg px-3 py-1.5 text-right font-semibold focus:ring-2 focus:ring-blue-500 outline-none">
              <span class="text-xs text-slate-400 w-6">hrs</span>
            </div>
          </div>

          <!-- Session Prep (New Input) -->
          <div class="flex items-center justify-between group">
            <div>
              <label class="text-sm font-bold text-indigo-900">Session Prep / Support</label>
              <p class="text-[10px] text-slate-400">Previously built-in ($0/hr)</p>
            </div>
            <div class="flex items-center gap-2">
              <input type="number" v-model.number="inputs.prepHours" class="w-20 bg-indigo-50 border border-indigo-200 rounded-lg px-3 py-1.5 text-right font-semibold text-indigo-700 focus:ring-2 focus:ring-indigo-500 outline-none">
              <span class="text-xs text-slate-400 w-6">hrs</span>
            </div>
          </div>

          <div class="h-px bg-slate-100 my-2"></div>

          <!-- Travel -->
          <div class="flex items-center justify-between group">
            <div>
              <label class="text-sm font-bold text-indigo-900">Travel Time</label>
              <p class="text-[10px] text-slate-400">Only paid in New Structure</p>
            </div>
            <div class="flex items-center gap-2">
              <input type="number" v-model.number="inputs.travelHours" class="w-20 bg-indigo-50 border border-indigo-200 rounded-lg px-3 py-1.5 text-right font-semibold text-indigo-700 focus:ring-2 focus:ring-indigo-500 outline-none">
              <span class="text-xs text-slate-400 w-6">hrs</span>
            </div>
          </div>

          <div class="h-px bg-slate-100 my-2"></div>

          <!-- Mileage -->
          <div class="flex items-center justify-between group">
            <label class="text-sm font-bold text-emerald-700">Mileage Reimb. (Fixed)</label>
            <div class="flex items-center gap-2">
              <input type="number" v-model.number="inputs.mileage" class="w-20 bg-emerald-50 border border-emerald-200 rounded-lg px-3 py-1.5 text-right font-semibold text-emerald-700 focus:ring-2 focus:ring-emerald-500 outline-none">
              <span class="text-xs text-slate-400 w-6">$</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 3. Config Card -->
      <div class="bg-indigo-600 p-6 rounded-2xl shadow-lg shadow-indigo-200 text-white">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-bold">New Pay Settings</h2>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        </div>

        <div class="mb-4">
          <label class="block text-sm text-indigo-100 mb-1 opacity-80">Hourly Base Rate</label>
          <div class="relative">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-indigo-600 font-bold">$</span>
            <input type="number" v-model.number="config.newHourlyRate" class="w-full pl-7 bg-white text-indigo-900 border-0 rounded-lg px-3 py-3 focus:ring-2 focus:ring-white outline-none font-bold text-lg shadow-sm">
          </div>
        </div>

        <div class="flex justify-between items-center text-sm opacity-80 pt-4 border-t border-indigo-500">
          <span>Session Bonus</span>
          <span class="font-mono font-bold">$30.00 / session</span>
        </div>
      </div>
    </div>

    <!-- ================= RESULTS COLUMN ================= -->
    <div class="lg:col-span-8 flex flex-col gap-6">

      <!-- Summary Stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Old Pay -->
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200 flex flex-col justify-between h-32">
          <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Current Paycheck</p>
          <div>
            <p class="text-3xl font-bold text-slate-700">{{ formatCurrency(oldTotal) }}</p>
            <p class="text-xs text-slate-400 mt-1">Based on Session Type</p>
          </div>
        </div>

        <!-- New Pay -->
        <div class="bg-slate-900 p-5 rounded-2xl shadow-lg border border-slate-700 relative overflow-hidden flex flex-col justify-between h-32 group">
          <div class="absolute top-0 right-0 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl -mr-10 -mt-10 transition-transform group-hover:scale-110 duration-700"></div>
          <p class="text-xs font-bold text-indigo-300 uppercase tracking-widest relative z-10">Proposed Paycheck</p>
          <div class="relative z-10">
            <p class="text-3xl font-bold text-white">{{ formatCurrency(newTotal) }}</p>
            <p class="text-xs text-indigo-300/70 mt-1">Based on Hours + Bonus</p>
          </div>
        </div>

        <!-- Difference -->
        <div :class="['p-5 rounded-2xl shadow-sm border flex flex-col justify-between h-32', diffColorClass]">
          <p class="text-xs font-bold opacity-60 uppercase tracking-widest">Difference</p>
          <div>
            <p class="text-3xl font-bold">{{ diffPrefix }}{{ formatCurrency(Math.abs(difference)) }}</p>
            <p class="text-xs opacity-70 mt-1 font-medium">
              {{ difference > 0 ? 'Increase per check' : 'Decrease per check' }}
            </p>
          </div>
        </div>
      </div>

      <!-- Chart Area -->
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex-1 flex flex-col min-h-[400px]">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-lg font-bold text-slate-800">Income Composition</h3>
          <div class="flex gap-4 text-xs font-medium">
            <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-slate-400"></div> Current</div>
            <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-indigo-500"></div> Proposed</div>
          </div>
        </div>
        <div class="relative flex-1 w-full">
          <canvas id="payChart"></canvas>
        </div>
      </div>

      <!-- Detailed Breakdown -->
      <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
          <h3 class="font-bold text-slate-700">Detailed Breakdown</h3>
        </div>
        <table class="w-full text-left text-sm text-slate-600">
          <thead class="bg-slate-50 text-xs uppercase font-semibold text-slate-500">
          <tr>
            <th class="px-6 py-3 w-1/3">Category</th>
            <th class="px-6 py-3 text-right">Current Logic</th>
            <th class="px-6 py-3 text-right">Proposed Logic</th>
          </tr>
          </thead>
          <tbody class="divide-y divide-slate-100">
          <!-- Sessions -->
          <tr class="hover:bg-slate-50/50 transition-colors">
            <td class="px-6 py-4">
              <span class="font-bold text-slate-700 block mb-1">Sessions</span>
              <span class="text-xs text-slate-400">
                                    {{ totalSessions }} total sessions<br>
                                    {{ newBreakdown.sessionHours }} billable hours
                                </span>
            </td>
            <td class="px-6 py-4 text-right">
              <div class="font-mono font-semibold text-slate-700">{{ formatCurrency(oldBreakdown.sessions) }}</div>
              <div class="text-[10px] text-slate-400 mt-1">Flat Fees ($112.5/$67.5)</div>
            </td>
            <td class="px-6 py-4 text-right bg-indigo-50/30">
              <div class="font-mono font-bold text-indigo-700">{{ formatCurrency(newBreakdown.sessions) }}</div>
              <div class="text-[10px] text-indigo-400 mt-1">
                ${{config.newHourlyRate}} &times; {{newBreakdown.sessionHours}}h + ($30 &times; {{totalSessions}})
              </div>
            </td>
          </tr>
          <!-- Admin -->
          <tr class="hover:bg-slate-50/50 transition-colors">
            <td class="px-6 py-4 font-bold text-slate-700">Admin Work</td>
            <td class="px-6 py-4 text-right">
              <div class="font-mono font-semibold text-slate-700">{{ formatCurrency(oldBreakdown.admin) }}</div>
              <div class="text-[10px] text-slate-400 mt-1">Tiered Rates ($15/$18)</div>
            </td>
            <td class="px-6 py-4 text-right bg-indigo-50/30">
              <div class="font-mono font-bold text-indigo-700">{{ formatCurrency(newBreakdown.admin) }}</div>
              <div class="text-[10px] text-indigo-400 mt-1">Flat Rate (${{config.newHourlyRate}}/hr)</div>
            </td>
          </tr>
          <!-- Prep Support (New) -->
          <tr class="hover:bg-slate-50/50 transition-colors">
            <td class="px-6 py-4 font-bold text-slate-700">Session Prep / Support</td>
            <td class="px-6 py-4 text-right">
              <div class="font-mono font-semibold text-slate-400">$0.00</div>
              <div class="text-[10px] text-slate-400 mt-1">Built-in (Unpaid)</div>
            </td>
            <td class="px-6 py-4 text-right bg-indigo-50/30">
              <div class="font-mono font-bold text-indigo-700">{{ formatCurrency(newBreakdown.prep) }}</div>
              <div class="text-[10px] text-indigo-400 mt-1">Hourly (${{config.newHourlyRate}} &times; {{inputs.prepHours}}h)</div>
            </td>
          </tr>
          <!-- Travel -->
          <tr class="hover:bg-slate-50/50 transition-colors">
            <td class="px-6 py-4 font-bold text-slate-700">Travel Time</td>
            <td class="px-6 py-4 text-right">
              <div class="font-mono font-semibold text-slate-400">$0.00</div>
              <div class="text-[10px] text-slate-400 mt-1">Unpaid</div>
            </td>
            <td class="px-6 py-4 text-right bg-indigo-50/30">
              <div class="font-mono font-bold text-indigo-700">{{ formatCurrency(newBreakdown.travel) }}</div>
              <div class="text-[10px] text-indigo-400 mt-1">Hourly (${{config.newHourlyRate}} &times; {{inputs.travelHours}}h)</div>
            </td>
          </tr>
          <!-- Mileage -->
          <tr class="hover:bg-slate-50/50 transition-colors">
            <td class="px-6 py-4 font-bold text-slate-700">Mileage Reimb.</td>
            <td class="px-6 py-4 text-right">
              <div class="font-mono font-semibold text-slate-700">{{ formatCurrency(inputs.mileage) }}</div>
              <div class="text-[10px] text-slate-400 mt-1">Fixed Input</div>
            </td>
            <td class="px-6 py-4 text-right bg-indigo-50/30">
              <div class="font-mono font-bold text-indigo-700">{{ formatCurrency(inputs.mileage) }}</div>
              <div class="text-[10px] text-indigo-400 mt-1">Fixed Input</div>
            </td>
          </tr>
          </tbody>
          <tfoot class="bg-slate-50 font-bold text-slate-800 border-t border-slate-200">
          <tr>
            <td class="px-6 py-4">Total Bi-Weekly Pay</td>
            <td class="px-6 py-4 text-right text-lg">{{ formatCurrency(oldTotal) }}</td>
            <td class="px-6 py-4 text-right text-lg text-indigo-700 bg-indigo-100/30">{{ formatCurrency(newTotal) }}</td>
          </tr>
          </tfoot>
        </table>
      </div>

      <!-- Rate Sensitivity Chart -->
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mt-2">
        <div class="flex justify-between items-start mb-6">
          <div>
            <h3 class="text-lg font-bold text-slate-800">Rate Sensitivity Analysis</h3>
            <p class="text-sm text-slate-500 mt-1">How paycheck changes with different hourly rates</p>
          </div>
          <div class="text-right bg-emerald-50 px-4 py-2 rounded-xl border border-emerald-100" v-if="breakEvenRate > 0 && isFinite(breakEvenRate)">
            <div class="text-xs font-bold uppercase text-emerald-800 tracking-wider mb-1">Break Even Rate</div>
            <div class="text-xl font-bold text-emerald-600">{{ formatCurrency(breakEvenRate) }}/hr</div>
            <div class="text-[10px] text-emerald-600/70">Proposed must be higher than this</div>
          </div>
        </div>
        <div class="relative h-[300px] w-full">
          <canvas id="rateChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const { createApp, ref, computed, watch, onMounted } = Vue;

  createApp({
    setup() {
      // Initial Inputs
      const inputs = ref({
        count30: 4,
        count60: 6,
        count90: 4,
        initialCount: 4, // Slider value
        adminStdHours: 6,
        adminSpecHours: 2,
        prepHours: 0,    // NEW: Session Prep Support
        travelHours: 8,
        mileage: 81
      });

      const config = ref({
        newHourlyRate: 20
      });

      // 1. Total Sessions Helper
      const totalSessions = computed(() => {
        return (inputs.value.count30 || 0) + (inputs.value.count60 || 0) + (inputs.value.count90 || 0);
      });

      // 2. Watcher: Prevent initialCount slider from exceeding Total Sessions
      watch(totalSessions, (newTotal) => {
        if (inputs.value.initialCount > newTotal) {
          inputs.value.initialCount = newTotal;
        }
      });

      // 3. Old Pay Calculation
      const oldBreakdown = computed(() => {
        const initial = Math.min(inputs.value.initialCount, totalSessions.value);
        const followups = Math.max(0, totalSessions.value - initial);

        const sessionPay = (initial * 112.5) + (followups * 67.5);
        const adminPay = (inputs.value.adminStdHours * 15) + (inputs.value.adminSpecHours * 18);
        const mileagePay = inputs.value.mileage;
        // Prep pay is $0 in old structure

        return {
          sessions: sessionPay,
          admin: adminPay,
          mileage: mileagePay,
          total: sessionPay + adminPay + mileagePay
        };
      });

      const oldTotal = computed(() => oldBreakdown.value.total);

      // 4. New Pay Calculation
      const newBreakdown = computed(() => {
        const rate = config.value.newHourlyRate;

        // Calculate Exact Hours from buckets
        const hoursFrom30 = (inputs.value.count30 || 0) * 0.5;
        const hoursFrom60 = (inputs.value.count60 || 0) * 1.0;
        const hoursFrom90 = (inputs.value.count90 || 0) * 1.5;

        const totalSessionHours = hoursFrom30 + hoursFrom60 + hoursFrom90;

        // Formula: (Hours * Rate) + (Count * Bonus)
        const sessionPay = (totalSessionHours * rate) + (totalSessions.value * 30);

        const adminHours = inputs.value.adminStdHours + inputs.value.adminSpecHours;
        const adminPay = adminHours * rate;

        const prepPay = (inputs.value.prepHours || 0) * rate;

        const travelPay = inputs.value.travelHours * rate;
        const mileagePay = inputs.value.mileage;

        // For rate chart calculation
        const totalBillableHours = totalSessionHours + adminHours + inputs.value.travelHours + (inputs.value.prepHours || 0);

        return {
          sessions: sessionPay,
          sessionHours: totalSessionHours,
          admin: adminPay,
          prep: prepPay,
          travel: travelPay,
          mileage: mileagePay,
          totalBillableHours: totalBillableHours,
          total: sessionPay + adminPay + prepPay + travelPay + mileagePay
        };
      });

      const newTotal = computed(() => newBreakdown.value.total);

      // 5. Comparison Logic
      const difference = computed(() => newTotal.value - oldTotal.value);
      const diffPrefix = computed(() => difference.value > 0 ? '+' : difference.value < 0 ? '-' : '');

      const diffColorClass = computed(() => {
        if (difference.value > 0) return 'bg-emerald-50 border-emerald-200 text-emerald-700';
        if (difference.value < 0) return 'bg-rose-50 border-rose-200 text-rose-700';
        return 'bg-slate-50 border-slate-200 text-slate-500';
      });

      // 6. Break Even Calculation
      const breakEvenRate = computed(() => {
        const hours = newBreakdown.value.totalBillableHours;
        const fixedBonus = totalSessions.value * 30;

        // Remove mileage from comparison since it is equal on both sides
        const oldPayWithoutMileage = oldBreakdown.value.sessions + oldBreakdown.value.admin;

        if (hours === 0) return 0;
        return (oldPayWithoutMileage - fixedBonus) / hours;
      });

      const formatCurrency = (val) => {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);
      };

      // 7. Charts
      let barChartInstance = null;
      let rateChartInstance = null;

      const updateCharts = () => {
        updateBarChart();
        updateRateChart();
      };

      const updateBarChart = () => {
        const ctx = document.getElementById('payChart');
        if(!ctx) return;

        // Group Admin + Prep for the chart to keep it simple, or we could add a new bar.
        // Let's group them into "Hourly Support"
        const oldHourlySupport = oldBreakdown.value.admin;
        const newHourlySupport = newBreakdown.value.admin + newBreakdown.value.prep;

        const oldData = [oldBreakdown.value.sessions, oldHourlySupport, 0, oldBreakdown.value.mileage];
        const newData = [newBreakdown.value.sessions, newHourlySupport, newBreakdown.value.travel, newBreakdown.value.mileage];

        if (barChartInstance) {
          barChartInstance.data.datasets[0].data = oldData;
          barChartInstance.data.datasets[1].data = newData;
          barChartInstance.update();
        } else {
          barChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: ['Session Income', 'Hourly Support', 'Travel Pay', 'Mileage'],
              datasets: [
                { label: 'Current Structure', data: oldData, backgroundColor: '#94a3b8', borderRadius: 4, barPercentage: 0.6 },
                { label: 'Proposed Structure', data: newData, backgroundColor: '#6366f1', borderRadius: 4, barPercentage: 0.6 }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: { legend: { display: false } },
              scales: {
                y: { beginAtZero: true, grid: { color: '#f1f5f9', drawBorder: false }, ticks: { callback: v => '$' + v }, border: { display: false } },
                x: { grid: { display: false }, border: { display: false } }
              }
            }
          });
        }
      };

      const updateRateChart = () => {
        const ctx = document.getElementById('rateChart');
        if(!ctx) return;

        const labels = [];
        const oldLine = [];
        const newLine = [];

        const startRate = 15;
        const endRate = 40;
        const step = 1;

        const fixedOld = oldTotal.value; // Includes mileage
        const billableHours = newBreakdown.value.totalBillableHours;
        const fixedBonus = (totalSessions.value * 30) + inputs.value.mileage; // Include mileage in fixed component

        for(let r = startRate; r <= endRate; r += step) {
          labels.push('$' + r);
          oldLine.push(fixedOld);
          newLine.push((billableHours * r) + fixedBonus);
        }

        if(rateChartInstance) {
          rateChartInstance.data.labels = labels;
          rateChartInstance.data.datasets[0].data = oldLine;
          rateChartInstance.data.datasets[1].data = newLine;
          rateChartInstance.update();
        } else {
          rateChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [
                {
                  label: 'Current Pay',
                  data: oldLine,
                  borderColor: '#94a3b8',
                  backgroundColor: '#94a3b8',
                  borderWidth: 2,
                  pointRadius: 0,
                  borderDash: [5, 5]
                },
                {
                  label: 'Proposed Pay',
                  data: newLine,
                  borderColor: '#8b5cf6', // violet-500
                  backgroundColor: '#8b5cf6',
                  borderWidth: 3,
                  pointRadius: 0,
                  pointHoverRadius: 6
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: { mode: 'index', intersect: false },
              plugins: {
                legend: { position: 'bottom' },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return context.dataset.label + ': ' + new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y);
                    }
                  }
                }
              },
              scales: {
                y: {
                  grid: { color: '#f1f5f9' },
                  ticks: { callback: v => '$' + v },
                  border: { display: false }
                },
                x: {
                  grid: { display: false },
                  border: { display: false }
                }
              }
            }
          });
        }
      };

      watch([inputs, config], () => { updateCharts(); }, { deep: true });
      onMounted(() => { updateCharts(); });

      return {
        inputs, config, totalSessions,
        oldTotal, newTotal, difference,
        diffPrefix, diffColorClass, formatCurrency,
        oldBreakdown, newBreakdown, breakEvenRate
      };
    }
  }).mount('#app');
</script>
</body>
</html>